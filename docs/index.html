<!DOCTYPE html>

<html>
<head>
  <title>Mooog</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          
          <h1 id="mooog">Mooog</h1>
<blockquote>
<p>Chainable AudioNode objects</p>
</blockquote>
<h3 id="what-is-mooog-">What is Mooog?</h3>
<p>Mooog is inspired by audio mixing boards on the one hand and jQuery chainable
syntax on the other. It automatically does a lot of stuff so you don’t have to.
Mooog’s goal is to take some of the tedium out of working with AudioNodes,
as well as patching some odd behaviors. With Mooog, instead of writing this:</p>
<pre><code class="lang-javascript">AudioContext = AudioContext || webkitAudioContext;  
<span class="hljs-keyword">var</span> ctxt = <span class="hljs-keyword">new</span> AudioContext();  
<span class="hljs-keyword">var</span> osc = ctxt.createOscillator();  
<span class="hljs-keyword">var</span> lfo = ctxt.createOscillator();  
<span class="hljs-keyword">var</span> gain = ctxt.createGain();  
osc.frequency.value = <span class="hljs-number">300</span>;  
lfo.type = <span class="hljs-string">'sawtooth'</span>;  
lfo.frequency.value = <span class="hljs-number">3</span>;  
lfo.connect(gain);  
gain.gain.value = <span class="hljs-number">40</span>;  
gain.connect(osc.frequency);  
osc.connect(ctxt.destination);  
lfo.start();  
osc.start();
</code></pre>
<p>…you can write this:</p>
<pre><code class="lang-javascript">M = <span class="hljs-keyword">new</span> Mooog();
M.node(
    { id:<span class="hljs-string">'lfo'</span>, node_type:<span class="hljs-string">'Oscillator'</span>, type:<span class="hljs-string">'sawtooth'</span>, frequency:<span class="hljs-number">3</span> }
  )
  .start()
  .chain(
    M.node( {id:<span class="hljs-string">'gain'</span>, node_type:<span class="hljs-string">'Gain'</span>, gain:<span class="hljs-number">40</span>} )
  )
  .chain(
    M.node({id:<span class="hljs-string">'osc'</span>, node_type:<span class="hljs-string">'Oscillator'</span>, frequency:<span class="hljs-number">300</span>}), <span class="hljs-string">'frequency'</span>
  )
  .start()
</code></pre>
<h3 id="what-mooog-isn-t">What Mooog isn’t</h3>
<p>Mooog is not a shim for the deprecated Audio API. It also doesn’t (yet) worry
about cross-platform issues. It is developed and tested on the latest version
of Google Chrome, and expects to run there. Ensuring cross-platform
consistency is on the to-do list once the API stabilizes. </p>
<h3 id="features">Features</h3>
<p>Mooog provides nestable <code>MooogAudioNode</code> objects that wrap AudioNodes. At a minumum, they
expose the methods of the wrapped Node, so you can talk to them just like the
underlying AudioNode. Many of them offer additional functionality.</p>
<p>There is also a specialized MooogAudioNode object called <code>Track</code>, which will automatically
create a panner and a gain module that can be controlled from a single place, as
well as effect sends. It automatically routes the end of its internal chain
to the destinationNode.</p>
<h3 id="patches">Patches</h3>
<ul>
<li>Allows <code>Oscillator</code>, <code>AudioBufferSource</code> nodes to be <code>stop()</code>ed and 
<code>start()</code>ed again without throwing errors.</li>
<li>Changes to <code>AudioParam</code> values via <code>.param()</code> are made using setValueAtTime(0)
to ensure values are set instantly</li>
</ul>
<h2 id="todo">Todo</h2>
<ul>
<li>Make AudioBufferSource start()able</li>
</ul>
<h3 id="attributions">Attributions</h3>
<p>The Convolver <code>MooogAudioNode</code> comes with some presets that make use of impulse responses
from the <a href="http://www.openairlib.net/">OpenAir</a> project:</p>
<ul>
<li><em>stalbans_a_binaural.wav</em><br>The Lady Chapel, St Albans Cathedral: 
<a href="http://creativecommons.org/licenses/by-sa/3.0/">CC share/share alike license</a><ul>
<li>www.openairlib.net</li>
<li>Audiolab, University of York</li>
<li>Marcin Gorzel</li>
<li>Gavin Kearney</li>
<li>Aglaia Foteinou</li>
<li>Sorrel Hoare</li>
<li>Simon Shelley</li>
</ul>
</li>
</ul>
<h2 id="mooogaudionode">MooogAudioNode</h2>
<p>Base class for all the node wrappers. </p>
<p>The MooogAudioNode object wraps one or more AudioNode objects. By default it 
exposes the <code>AudioNode</code> methods of the first AudioNode in the <code>_nodes</code>
array. </p>
<p>Signatures:</p>
<blockquote>
<p>MooogAudioNode(instance:Mooog , id:string, node_def:mixed)</p>
</blockquote>
<p><code>_instance</code>: The parent <code>Mooog</code> instance<br><code>id</code>: A unique identifier to assign to this Node
<code>node_def</code>: Either a string representing the type of Node to initialize
or an object with initialization params (see below) </p>
<blockquote>
<p>MooogAudioNode(instance:Mooog , node_definition:object [, node_definition…])</p>
</blockquote>
<p><code>_instance</code>: The parent <code>Mooog</code> instance<br><code>node_definition</code>: An object used to create and configure the new Node. </p>
<p>Required properties:</p>
<ul>
<li><code>id</code>: Unique string identifier</li>
<li><code>node_type</code>: String indicating the type of Node (Oscillator, Gain, etc.)</li>
</ul>
<p>Optional properties for all nodes</p>
<ul>
<li><code>connect_to_destination</code>: Boolean indicating whether the last in this node’s 
<code>_nodes</code> array is automatically connected to the <code>AudioDestinationNode</code>. <em>default: true</em></li>
</ul>
<p>Additional properties  </p>
<ul>
<li>Any additional key-value pairs will be used to set properties of the underlying <code>AudioNode</code>
object after initialization. </li>
</ul>

          
            <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MooogAudioNode</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, node_list...)</span> -&gt;</span>
    <span class="hljs-property">@_destination</span> = <span class="hljs-property">@_instance</span>._destination
    <span class="hljs-property">@context</span> = <span class="hljs-property">@_instance</span>.context
    <span class="hljs-property">@_nodes</span> = []
    <span class="hljs-property">@config_defaults</span> =
      <span class="hljs-attribute">connect_to_destination</span>: <span class="hljs-literal">true</span>
    <span class="hljs-property">@config</span> = {}</pre></div>
          
        

        
      </div>

      
        
        <p>Take care of first type signature (ID and string type)</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> <span class="hljs-property">@__typeof</span>(node_list[<span class="hljs-number">0</span>]) <span class="hljs-keyword">is</span> <span class="hljs-string">"string"</span> \
    <span class="hljs-keyword">and</span> <span class="hljs-property">@__typeof</span>(node_list[<span class="hljs-number">1</span>]) <span class="hljs-keyword">is</span> <span class="hljs-string">"string"</span> \
    <span class="hljs-keyword">and</span> Mooog.LEGAL_NODES[node_list[<span class="hljs-number">1</span>]]?
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Mooog.LEGAL_NODES[node_list[<span class="hljs-number">1</span>]] <span class="hljs-property">@_instance</span>, { <span class="hljs-attribute">id</span>: node_list[<span class="hljs-number">0</span>] }</pre></div>
        
      
        
        <p>Otherwise, this is one or more config objects.</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">if</span> node_list.length <span class="hljs-keyword">is</span> <span class="hljs-number">1</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> <span class="hljs-property">@constructor</span>.name <span class="hljs-keyword">is</span> <span class="hljs-string">"MooogAudioNode"</span>
      <span class="hljs-keyword">if</span> Mooog.LEGAL_NODES[node_list[<span class="hljs-number">0</span>].node_type]?
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Mooog.LEGAL_NODES[node_list[<span class="hljs-number">0</span>].node_type] <span class="hljs-property">@_instance</span>, node_list[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Omitted or undefined node type in config options."</span>)
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> node_list
        <span class="hljs-keyword">if</span> Mooog.LEGAL_NODES[node_list[i].node_type?]
          <span class="hljs-property">@_nodes</span>.push <span class="hljs-keyword">new</span> Mooog.LEGAL_NODES[node_list[i].node_type] <span class="hljs-property">@_instance</span>, node_list[i]
        <span class="hljs-keyword">else</span>
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Omitted or undefined node type in config options."</span>)</pre></div>
        
      
        
        <h3 id="mooogaudionode-configure_from">MooogAudioNode.configure_from</h3>
<p>The config object can contain general configuration options or key/value pairs to be set on the
wrapped <code>AudioNode</code>. This function merges the config defaults with the supplied options and sets
the <code>config</code> property of the node</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">configure_from</span>: <span class="hljs-function"><span class="hljs-params">(ob)</span> -&gt;</span>
    <span class="hljs-property">@id</span> = <span class="hljs-keyword">if</span> ob.id? <span class="hljs-keyword">then</span> ob.id <span class="hljs-keyword">else</span> <span class="hljs-property">@new_id</span>()
    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> <span class="hljs-property">@config_defaults</span>
      <span class="hljs-property">@config</span>[k] = <span class="hljs-keyword">if</span> (k <span class="hljs-keyword">of</span> ob) <span class="hljs-keyword">then</span> ob[k] <span class="hljs-keyword">else</span> <span class="hljs-property">@config_defaults</span>[k]
    <span class="hljs-property">@config</span></pre></div>
        
      
        
        <h3 id="mooogaudionode-zero_node_settings">MooogAudioNode.zero_node_settings</h3>
<p>XORs the supplied configuration object with the defaults to return an object the properties of which
should be set on the zero node</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">zero_node_settings</span>: <span class="hljs-function"><span class="hljs-params">(ob)</span> -&gt;</span>
    zo = {}
    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> ob
      zo[k] = v <span class="hljs-keyword">unless</span> k <span class="hljs-keyword">of</span> <span class="hljs-property">@config_defaults</span> <span class="hljs-keyword">or</span> k <span class="hljs-keyword">is</span> <span class="hljs-string">'node_type'</span> <span class="hljs-keyword">or</span> k <span class="hljs-keyword">is</span> <span class="hljs-string">'id'</span>
    zo</pre></div>
        
      
        
        <h3 id="mooogaudionode-zero_node_setup">MooogAudioNode.zero_node_setup</h3>
<p>Runs after the MooogAudioNode constructor by the inheriting classes. Exposes the underlying
<code>AudioNode</code> properties and sets any <code>AudioNode</code>-specific properties supplied in the 
configuration object.</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">zero_node_setup</span>: <span class="hljs-function"><span class="hljs-params">(config)</span> -&gt;</span>
    <span class="hljs-property">@expose_methods_of</span> <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>]?
    <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> <span class="hljs-property">@zero_node_settings</span>(config)
      <span class="hljs-property">@debug</span> <span class="hljs-string">"zero node settings, <span class="hljs-subst">#{k}</span> = <span class="hljs-subst">#{v}</span>"</span>
      <span class="hljs-property">@param</span> k, v</pre></div>
        
      
        
        <h3 id="mooogaudionode-tostring">MooogAudioNode.toString</h3>
<p>Includes the ID in the string representation of the object.      </p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">toString</span>: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-string">"<span class="hljs-subst">#{@.constructor.name}</span>#"</span>+<span class="hljs-property">@id</span></pre></div>
        
      
        
        <h3 id="mooogaudionode-new_id">MooogAudioNode.new_id</h3>
<p>Generates a new string identifier for this node.</p>

        
          <div class='highlight'><pre>  
  <span class="hljs-attribute">new_id</span>: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-string">"<span class="hljs-subst">#{@.constructor.name}</span>_<span class="hljs-subst">#{Math.round(Math.random()*<span class="hljs-number">100000</span>)}</span>"</span></pre></div>
        
      
        
        <h3 id="mooogaudionode-__typeof">MooogAudioNode.__typeof</h3>
<p>This is a modified <code>typeof</code> to filter AudioContext API-specific object types</p>

        
          <div class='highlight'><pre>  
  <span class="hljs-attribute">__typeof</span>: <span class="hljs-function"><span class="hljs-params">(thing)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"AudioParam"</span> <span class="hljs-keyword">if</span> thing <span class="hljs-keyword">instanceof</span> AudioParam
    <span class="hljs-keyword">return</span> <span class="hljs-string">"AudioNode"</span> <span class="hljs-keyword">if</span> thing <span class="hljs-keyword">instanceof</span> AudioNode
    <span class="hljs-keyword">return</span> <span class="hljs-string">"AudioBuffer"</span> <span class="hljs-keyword">if</span> thing <span class="hljs-keyword">instanceof</span> AudioBuffer
    <span class="hljs-keyword">return</span> <span class="hljs-string">"PeriodicWave"</span> <span class="hljs-keyword">if</span> thing <span class="hljs-keyword">instanceof</span> PeriodicWave
    <span class="hljs-keyword">return</span> <span class="hljs-string">"AudioListener"</span> <span class="hljs-keyword">if</span> thing <span class="hljs-keyword">instanceof</span> AudioListener
    <span class="hljs-keyword">return</span> <span class="hljs-string">"MooogAudioNode"</span> <span class="hljs-keyword">if</span> thing <span class="hljs-keyword">instanceof</span> MooogAudioNode
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span>(thing)</pre></div>
        
      
        
        <h3 id="mooogaudionode-insert_node">MooogAudioNode.insert_node</h3>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">insert_node</span>: <span class="hljs-function"><span class="hljs-params">(node, ord)</span> -&gt;</span>
    length = <span class="hljs-property">@_nodes</span>.length
    ord = length <span class="hljs-keyword">unless</span> ord?
    
    node.disconnect node._destination <span class="hljs-keyword">if</span> node._destination?
            
    <span class="hljs-keyword">if</span> ord &gt; length
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Invalid index given to insert_node: "</span> + ord +
      <span class="hljs-string">" out of "</span> + length)
    <span class="hljs-property">@debug</span> <span class="hljs-string">"insert_node of <span class="hljs-subst">#{@}</span> for"</span>, node, ord

    <span class="hljs-keyword">if</span> ord <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
      <span class="hljs-property">@connect_incoming</span> node
      <span class="hljs-property">@disconnect_incoming</span> <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>]

      <span class="hljs-keyword">if</span> length &gt; <span class="hljs-number">1</span>
        node.connect <span class="hljs-property">@to</span> <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>]
        <span class="hljs-property">@debug</span> <span class="hljs-string">'- node.connect to '</span>, <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>]

    <span class="hljs-keyword">if</span> ord <span class="hljs-keyword">is</span> length
      <span class="hljs-property">@safely_disconnect</span> <span class="hljs-property">@_nodes</span>[ord - <span class="hljs-number">1</span>], (<span class="hljs-property">@from</span> <span class="hljs-property">@_destination</span>) <span class="hljs-keyword">if</span> ord <span class="hljs-keyword">isnt</span> <span class="hljs-number">0</span>
      <span class="hljs-property">@debug</span>(<span class="hljs-string">"- disconnect "</span>, <span class="hljs-property">@_nodes</span>[ord - <span class="hljs-number">1</span>], <span class="hljs-string">'from'</span>, <span class="hljs-property">@_destination</span>) <span class="hljs-keyword">if</span> ord <span class="hljs-keyword">isnt</span> <span class="hljs-number">0</span>
      
      <span class="hljs-keyword">if</span> <span class="hljs-property">@config</span>.connect_to_destination
        node.connect <span class="hljs-property">@to</span> <span class="hljs-property">@_destination</span>
        <span class="hljs-property">@debug</span> <span class="hljs-string">'- connect'</span>, node, <span class="hljs-string">'to'</span>, <span class="hljs-property">@_destination</span>
      
      <span class="hljs-property">@_nodes</span>[ord - <span class="hljs-number">1</span>].connect <span class="hljs-property">@to</span> node <span class="hljs-keyword">if</span> ord <span class="hljs-keyword">isnt</span> <span class="hljs-number">0</span>
      <span class="hljs-property">@debug</span> <span class="hljs-string">'- connect'</span>, <span class="hljs-property">@_nodes</span>[ord - <span class="hljs-number">1</span>], <span class="hljs-string">"to"</span>, node <span class="hljs-keyword">if</span> ord <span class="hljs-keyword">isnt</span> <span class="hljs-number">0</span>

    <span class="hljs-keyword">if</span> ord <span class="hljs-keyword">isnt</span> length <span class="hljs-keyword">and</span> ord <span class="hljs-keyword">isnt</span> <span class="hljs-number">0</span>
      <span class="hljs-property">@safely_disconnect</span> <span class="hljs-property">@_nodes</span>[ord - <span class="hljs-number">1</span>], (<span class="hljs-property">@from</span> <span class="hljs-property">@_nodes</span>[ord])
      <span class="hljs-property">@debug</span> <span class="hljs-string">"- disconnect"</span>, <span class="hljs-property">@_nodes</span>[ord - <span class="hljs-number">1</span>], <span class="hljs-string">"from"</span>, <span class="hljs-property">@_nodes</span>[ord]
      <span class="hljs-property">@_nodes</span>[ord - <span class="hljs-number">1</span>].connect <span class="hljs-property">@to</span> node
      <span class="hljs-property">@debug</span> <span class="hljs-string">"- connect"</span>, <span class="hljs-property">@_nodes</span>[ord - <span class="hljs-number">1</span>], <span class="hljs-string">"to"</span>, node
      node.connect <span class="hljs-property">@to</span> <span class="hljs-property">@_nodes</span>[ord]
      <span class="hljs-property">@debug</span> <span class="hljs-string">"- connect"</span>, node, <span class="hljs-string">"to"</span>, <span class="hljs-property">@_nodes</span>[ord]
    
    <span class="hljs-property">@_nodes</span>.splice ord, <span class="hljs-number">0</span>, node
    <span class="hljs-property">@debug</span> <span class="hljs-string">"- spliced:"</span>, <span class="hljs-property">@_nodes</span></pre></div>
        
      
        
        <h3 id="mooogaudionode-add">MooogAudioNode.add</h3>
<p>Shortcut for insert_node</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">add</span>: <span class="hljs-function"><span class="hljs-params">(nodes)</span> -&gt;</span>
    nodes = [nodes] <span class="hljs-keyword">unless</span> nodes <span class="hljs-keyword">instanceof</span> Array
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> nodes
      <span class="hljs-keyword">switch</span> <span class="hljs-property">@__typeof</span> i
        <span class="hljs-keyword">when</span> <span class="hljs-string">"MooogAudioNode"</span> <span class="hljs-keyword">then</span> <span class="hljs-property">@insert_node</span>(i)
        <span class="hljs-keyword">when</span> <span class="hljs-string">"object"</span> <span class="hljs-keyword">then</span> <span class="hljs-property">@insert_node</span>( <span class="hljs-property">@_instance</span>.node i )
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Unknown argument type (should be config object or MooogAudioNode)"</span>)
      

  <span class="hljs-attribute">connect_incoming</span>: <span class="hljs-function">-&gt;</span></pre></div>
        
      
        
        <p>@debug ‘do incoming’
todo: deal with incoming connections for 0 element</p>

        
          <div class='highlight'><pre>
  <span class="hljs-attribute">disconnect_incoming</span>: <span class="hljs-function">-&gt;</span></pre></div>
        
      
        
        <p>@debug ‘undo incoming’
todo: deal with incoming connections for 0 element</p>

        
      
        
        <h3 id="mooogaudionode-connect">MooogAudioNode.connect</h3>
<p><code>node</code>: The node object or string ID of the object to which to connect.<br><code>param</code>: Optional string name of the <code>AudioParam</code> member of <code>node</code> to
which to connect.<br><code>output</code>: Optional integer representing the output of this Node to use.<br><code>input</code>: If <code>param</code> is not specified (you are connecting to an <code>AudioNode</code>)
then this integer argument can be used to specify the input of the target
to connect to.  </p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">connect</span>: <span class="hljs-function"><span class="hljs-params">(node, output = <span class="hljs-number">0</span>, input = <span class="hljs-number">0</span>, return_this = <span class="hljs-literal">true</span>)</span> -&gt;</span>
    <span class="hljs-property">@debug</span> <span class="hljs-string">"called connect from <span class="hljs-subst">#{@}</span> to <span class="hljs-subst">#{node}</span>, <span class="hljs-subst">#{output}</span>"</span>
    
    <span class="hljs-keyword">switch</span> <span class="hljs-property">@__typeof</span> node
      
      <span class="hljs-keyword">when</span> <span class="hljs-string">"AudioParam"</span>
        <span class="hljs-property">@_nodes</span>[ <span class="hljs-property">@_nodes</span>.length - <span class="hljs-number">1</span> ].connect node, output
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">"string"</span>
        node = <span class="hljs-property">@_instance</span>.node node
        target = node._nodes[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">when</span> <span class="hljs-string">"MooogAudioNode"</span>
        target = node._nodes[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">when</span> <span class="hljs-string">"AudioNode"</span>
        target = node
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Unknown node type passed to connect"</span>
      
    <span class="hljs-keyword">switch</span>
      <span class="hljs-keyword">when</span> <span class="hljs-keyword">typeof</span>(output) <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
        <span class="hljs-property">@_nodes</span>[ <span class="hljs-property">@_nodes</span>.length - <span class="hljs-number">1</span> ].connect target[output], input
      <span class="hljs-keyword">when</span> <span class="hljs-keyword">typeof</span>(output) <span class="hljs-keyword">is</span> <span class="hljs-string">'number'</span>
        <span class="hljs-property">@_nodes</span>[ <span class="hljs-property">@_nodes</span>.length - <span class="hljs-number">1</span> ].connect target, output, input
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> return_this <span class="hljs-keyword">then</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">else</span> node</pre></div>
        
      
        
        <h3 id="mooogaudionode-chain">MooogAudioNode.chain</h3>
<p>Like <code>MooogAudioNode.connect</code> with two important differences. First, it returns the 
<code>MooogAudioNode</code> you are connecting to. Second, it automatically disconnects the calling
<code>MooogAudioNode</code> from the context’s <code>AudioDestinationNode</code>. To use with <code>AudioParam</code>s, 
use the name of the param as the second argument (and the base <code>MooogAudioNode</code> as the first).</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">chain</span>: <span class="hljs-function"><span class="hljs-params">(node, output = <span class="hljs-number">0</span>, input = <span class="hljs-number">0</span>)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@__typeof</span>(node) <span class="hljs-keyword">is</span> <span class="hljs-string">"AudioParam"</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">typeof</span>(output) <span class="hljs-keyword">isnt</span> <span class="hljs-string">'string'</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"MooogAudioNode.chain() can only target AudioParams when used with
      the signature .chain(target_node:Node, target_param_name:string)"</span>
    <span class="hljs-property">@disconnect</span> <span class="hljs-property">@_destination</span>
    <span class="hljs-property">@connect</span> node, output, input, <span class="hljs-literal">false</span></pre></div>
        
      
        
        <h3 id="mooogaudionode-to-mooogaudionode-from">MooogAudioNode.to, MooogAudioNode.from</h3>
<p>These functions are synonyms and exist to improve code readability in the <code>connect</code>
and <code>disconnect</code> functions.</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">to</span>: <span class="hljs-function"><span class="hljs-params">(node)</span> -&gt;</span>
    <span class="hljs-keyword">switch</span> <span class="hljs-property">@__typeof</span> node
      <span class="hljs-keyword">when</span> <span class="hljs-string">"MooogAudioNode"</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> node._nodes[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">when</span> <span class="hljs-string">"AudioNode"</span> <span class="hljs-keyword">then</span> <span class="hljs-keyword">return</span> node
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Unknown node type passed to connect"</span>
  
  <span class="hljs-attribute">from</span>: @.prototype.to</pre></div>
        
      
        
        <h3 id="mooogaudionode-expose_methods_of">MooogAudioNode.expose_methods_of</h3>
<p>Exposes the properties of a wrapped <code>AudioNode</code> on <code>this</code></p>

        
          <div class='highlight'><pre>  
  <span class="hljs-attribute">expose_methods_of</span>: <span class="hljs-function"><span class="hljs-params">(node)</span> -&gt;</span>
    <span class="hljs-property">@debug</span> <span class="hljs-string">"exposing"</span>, node
    <span class="hljs-keyword">for</span> key,val <span class="hljs-keyword">of</span> node
      <span class="hljs-keyword">if</span> @[key]? <span class="hljs-keyword">then</span> <span class="hljs-keyword">continue</span></pre></div>
        
      
        
        <p>@debug “- checking #{key}: got”, @__typeof val</p>

        
          <div class='highlight'><pre>      <span class="hljs-keyword">switch</span> <span class="hljs-property">@__typeof</span> val
        <span class="hljs-keyword">when</span> <span class="hljs-string">'function'</span>
          @[key] = val.bind node
        <span class="hljs-keyword">when</span> <span class="hljs-string">'AudioParam'</span>
          @[key] = val
        <span class="hljs-keyword">when</span> <span class="hljs-string">"string"</span>, <span class="hljs-string">"number"</span>, <span class="hljs-string">"boolean"</span>, <span class="hljs-string">"object"</span>
          (<span class="hljs-function"><span class="hljs-params">(o, node, key)</span> -&gt;</span>
            Object.defineProperty o, key, {
              <span class="hljs-attribute">get</span>: <span class="hljs-function">-&gt;</span>
                node[key]
              <span class="hljs-attribute">set</span>: <span class="hljs-function"><span class="hljs-params">(val)</span> -&gt;</span>
                node[key] = val
              <span class="hljs-attribute">enumerable</span>: <span class="hljs-literal">true</span>
              <span class="hljs-attribute">configurable</span>: <span class="hljs-literal">true</span>
            })(@, node, key)</pre></div>
        
      
        
        <h3 id="mooogaudionode-safely_disconnect">MooogAudioNode.safely_disconnect</h3>
<p>Prevents <code>InvalidAccessError</code>s from stopping program execution if you try to use disconnect on 
a node that’s not already connected.</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">safely_disconnect</span>: <span class="hljs-function"><span class="hljs-params">(node1, node2, output = <span class="hljs-number">0</span>, input = <span class="hljs-number">0</span>)</span> -&gt;</span>
    <span class="hljs-keyword">switch</span> <span class="hljs-property">@__typeof</span> node1
      <span class="hljs-keyword">when</span> <span class="hljs-string">"MooogAudioNode"</span> <span class="hljs-keyword">then</span> source = node1._nodes[ node1._nodes.length - <span class="hljs-number">1</span> ]
      <span class="hljs-keyword">when</span> <span class="hljs-string">"AudioNode"</span>, <span class="hljs-string">"AudioParam"</span> <span class="hljs-keyword">then</span> source = node1
      <span class="hljs-keyword">when</span> <span class="hljs-string">"string"</span> <span class="hljs-keyword">then</span> source = <span class="hljs-property">@_instance</span>.node node1
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Unknown node type passed to disconnect"</span>
    <span class="hljs-keyword">switch</span> <span class="hljs-property">@__typeof</span> node2
      <span class="hljs-keyword">when</span> <span class="hljs-string">"MooogAudioNode"</span> <span class="hljs-keyword">then</span> target = node2._nodes[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">when</span> <span class="hljs-string">"AudioNode"</span>, <span class="hljs-string">"AudioParam"</span> <span class="hljs-keyword">then</span> target = node2
      <span class="hljs-keyword">when</span> <span class="hljs-string">"string"</span> <span class="hljs-keyword">then</span> target = <span class="hljs-property">@_instance</span>.node node2
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"Unknown node type passed to disconnect"</span>
    <span class="hljs-keyword">try</span>
      source.disconnect target, output, input
    <span class="hljs-keyword">catch</span> e
      <span class="hljs-property">@debug</span>(<span class="hljs-string">"ignored InvalidAccessError disconnecting <span class="hljs-subst">#{target}</span> from <span class="hljs-subst">#{source}</span>"</span>)
    @</pre></div>
        
      
        
        <h3 id="mooogaudionode-disconnect">MooogAudioNode.disconnect</h3>
<p>Replace the native <code>disconnect</code> function with a safe version, in case it is called directly.</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">disconnect</span>: <span class="hljs-function"><span class="hljs-params">(node, output = <span class="hljs-number">0</span>, input = <span class="hljs-number">0</span>)</span> -&gt;</span>
    <span class="hljs-property">@safely_disconnect</span> @, node, output, input</pre></div>
        
      
        
        <h3 id="mooogaudionode-param">MooogAudioNode.param</h3>
<p>jQuery-style getter/setter that also works on <code>AudioParam</code> properties. Signatures:</p>
<blockquote>
<p>param( key:string [, value:mixed])</p>
</blockquote>
<p>With two arguments, the first is taken as the property to get or set. If there’s a 
second property it’s used to set the value. </p>
<blockquote>
<p>MooogAudioNode( { key: value [, key: value]… 
[, ramp: rampType:string] [, at:float ] [, cancel:boolean]  } )</p>
</blockquote>
<p>When passed an object, the properties of the object are used to set values on <code>this</code>.
Parameters are set immediately unless the <code>at</code> property is set, which is a float representing the
number of seconds in the future at which the param should be set.<br><code>ramp</code>: An enumerated string: ‘none’, ‘linear’, ‘expo’. <em>Defaults to ‘none’</em><br><code>at</code>: A float representing the number of seconds in the future or after
the last scheduled change, depending on the next param <em>Defaults to 0</em><br><code>cancel</code>: whether to call <code>cancelScheduledValues</code> before setting the parameter(s) <em>Defaults to true</em></p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">param</span>: <span class="hljs-function"><span class="hljs-params">(key, val)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@__typeof</span>(key) <span class="hljs-keyword">is</span> <span class="hljs-string">'object'</span>
      at = parseFloat(key.at) || <span class="hljs-number">0</span>
      cancel = <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> key.cancel <span class="hljs-keyword">isnt</span> <span class="hljs-string">'undefined'</span> <span class="hljs-keyword">then</span> key.cancel <span class="hljs-keyword">else</span> <span class="hljs-literal">true</span>
      <span class="hljs-property">@debug</span> <span class="hljs-string">"keyramp"</span>, key.ramp
      <span class="hljs-keyword">switch</span> key.ramp
        <span class="hljs-keyword">when</span> <span class="hljs-string">'linear'</span> <span class="hljs-keyword">then</span> rampfun = <span class="hljs-string">'linearRampToValueAtTime'</span>
        <span class="hljs-keyword">when</span> <span class="hljs-string">'expo'</span> <span class="hljs-keyword">then</span> rampfun = <span class="hljs-string">'exponentialRampToValueAtTime'</span>
        <span class="hljs-keyword">else</span> rampfun = <span class="hljs-string">'setValueAtTime'</span>
      <span class="hljs-property">@get_set</span> k, v, rampfun, at, cancel <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">of</span> key
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
    <span class="hljs-keyword">return</span> <span class="hljs-property">@get_set</span> key, val, <span class="hljs-string">'setValueAtTime'</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span></pre></div>
        
      
        
        <h3 id="mooogaudionode-get_set">MooogAudioNode.get_set</h3>
<p>Handles the getting/setting for <code>MooogAudioNode.param</code>. Uses setValueAtTime
when dealing with <code>AudioParam</code>s to make sure changes are made, and immediate.
See <a href="https://jsfiddle.net/5xqhwzwu/">https://jsfiddle.net/5xqhwzwu/1/</a>. See the
<code>param</code> definition for the arguments.</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">get_set</span>: <span class="hljs-function"><span class="hljs-params">(key, val, rampfun, at, cancel)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> @[key]?
    <span class="hljs-property">@debug</span> <span class="hljs-string">"rampfun <span class="hljs-subst">#{rampfun}</span> at <span class="hljs-subst">#{at}</span> cancel <span class="hljs-subst">#{cancel}</span>"</span>
    <span class="hljs-keyword">switch</span> <span class="hljs-property">@__typeof</span> @[key]
      <span class="hljs-keyword">when</span> <span class="hljs-string">"AudioParam"</span>
        <span class="hljs-keyword">if</span> val?
          @[key].cancelScheduledValues(<span class="hljs-property">@context</span>.currentTime) <span class="hljs-keyword">if</span> cancel
          val = <span class="hljs-property">@_instance</span>.config.fake_zero <span class="hljs-keyword">if</span> val <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
          @[key][rampfun] val, <span class="hljs-property">@context</span>.currentTime + at
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
        <span class="hljs-keyword">else</span>
          @[key].value
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">if</span> val?
          @[key] = val
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
        <span class="hljs-keyword">else</span> @[key]</pre></div>
        
      
        
        <h3 id="mooogaudionode-define_buffer_source_properties">MooogAudioNode.define_buffer_source_properties</h3>
<p>Sets up useful functions on <code>MooogAudioNode</code>s that have a <code>buffer</code> property </p>
<h1 id="todo-emit-loaded-event">Todo: emit loaded event</h1>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">define_buffer_source_properties</span>: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-property">@_buffer_source_file_url</span> = <span class="hljs-string">''</span>
    Object.defineProperty @, <span class="hljs-string">'buffer_source_file'</span>, {
      <span class="hljs-attribute">get</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@_buffer_source_file_url</span>
      <span class="hljs-attribute">set</span>: <span class="hljs-function"><span class="hljs-params">(filename)</span> =&gt;</span>
        request = <span class="hljs-keyword">new</span> XMLHttpRequest()
        request.open(<span class="hljs-string">'GET'</span>, filename, <span class="hljs-literal">true</span>)
        request.responseType = <span class="hljs-string">'arraybuffer'</span>
        request.onload = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>
          <span class="hljs-property">@debug</span> <span class="hljs-string">"loaded <span class="hljs-subst">#{filename}</span>"</span>
          <span class="hljs-property">@_buffer_source_file_url</span> = filename
          <span class="hljs-property">@_instance</span>.context.decodeAudioData request.response, <span class="hljs-function"><span class="hljs-params">(buffer)</span> =&gt;</span>
            <span class="hljs-property">@debug</span> <span class="hljs-string">"setting buffer"</span>,buffer
            <span class="hljs-property">@buffer</span> = buffer
          , <span class="hljs-function"><span class="hljs-params">(error)</span> -&gt;</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Could not decode audio data from <span class="hljs-subst">#{request.responseURL}</span>
             - unsupported file format?"</span>)
        request.send()
      <span class="hljs-attribute">enumerable</span>: <span class="hljs-literal">true</span>
      <span class="hljs-attribute">configurable</span>: <span class="hljs-literal">true</span>
    }</pre></div>
        
      
        
        <h3 id="mooogaudionode-define_readonly_property">MooogAudioNode.define_readonly_property</h3>

        
          <div class='highlight'><pre>    
  <span class="hljs-attribute">define_readonly_property</span>: <span class="hljs-function"><span class="hljs-params">(prop_name, func)</span> -&gt;</span>
    Object.defineProperty @, prop_name, {
      <span class="hljs-attribute">get</span>: func
      <span class="hljs-attribute">set</span>: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"<span class="hljs-subst">#{@}</span>.<span class="hljs-subst">#{prop_name}</span> is read-only"</span>)
      <span class="hljs-attribute">enumerable</span>: <span class="hljs-literal">true</span>
      <span class="hljs-attribute">configurable</span>: <span class="hljs-literal">false</span>
    }</pre></div>
        
      
        
        <h3 id="mooogaudionode-adsr">MooogAudioNode.adsr</h3>
<p>Applies an ADSR, ASR, or ADS envelope of value changes to an <code>AudioParam</code>.<br><code>param</code>: An <code>AudioParam</code> or a string representing the name of the property, assumed to be on <code>this</code>.<br><code>config</code>: Object with the following properties (fake_zero is a very small number 
used in place of actual zero, which will throw errors when passed to 
<code>exponentialRampToValueAtTime</code>).  </p>
<ul>
<li>base: The value to start and end with. <em>Defaults to ‘zero’</em></li>
<li>times: An array of time values representing the ending time of each of the 
ADSR stages. The first is relative to the currentTime, and the others are relative
to the previous value. The delay stage can be suppressed by passing an array of three 
elements, in which case the envelope will be an ASR and the <code>s</code> value will be ignored.
The release stage can be suppressed by passing an array of 2 elements, in which case the
envelope will be an ADS envelope (useful if you’re responding to user input or don’t
know the duration of the note.)</li>
<li>a: The final value of the parameter at the end of the attack stage. <em>Defaults to 1</em></li>
<li>s: The value of the parameter at the end of the delay stage (or attack stage, 
if delay is omitted), to be held until the beginning of the release stage. <em>Defaults to 1</em></li>
</ul>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">adsr</span>: <span class="hljs-function"><span class="hljs-params">(param, config)</span> -&gt;</span>
    param = @[param] <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span>(param) <span class="hljs-keyword">is</span> <span class="hljs-string">"string"</span>
    _0 = <span class="hljs-property">@_instance</span>.config.fake_zero
    { base, times, a, s } = config
    base ?= _0
    base = _0 <span class="hljs-keyword">if</span> base <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
    a ?= <span class="hljs-number">1</span>
    a = _0 <span class="hljs-keyword">if</span> a <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
    s ?= <span class="hljs-number">1</span>
    s = _0 <span class="hljs-keyword">if</span> s <span class="hljs-keyword">is</span> <span class="hljs-number">0</span>
    t = <span class="hljs-property">@context</span>.currentTime
    times[<span class="hljs-number">0</span>] ||= _0
    times[<span class="hljs-number">1</span>] ||= _0
    times[<span class="hljs-number">2</span>] ||= _0 <span class="hljs-keyword">if</span> times.length &gt; <span class="hljs-number">2</span>
    times[<span class="hljs-number">3</span>] ||= _0 <span class="hljs-keyword">if</span> times.length &gt; <span class="hljs-number">3</span>
    config.ramp_type ?= <span class="hljs-property">@_instance</span>.config.default_ramp_type</pre></div>
        
      
        
        <p>todo: allow ramp_type to be an array with different values for each stage</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">switch</span> config.ramp_type
      <span class="hljs-keyword">when</span> <span class="hljs-string">'linear'</span> <span class="hljs-keyword">then</span> ramp = param.linearRampToValueAtTime.bind param
      <span class="hljs-keyword">when</span> <span class="hljs-string">'exponential'</span> <span class="hljs-keyword">then</span> ramp = param.exponentialRampToValueAtTime.bind param
    
    
    <span class="hljs-keyword">if</span>(times.length <span class="hljs-keyword">is</span> <span class="hljs-number">2</span>)</pre></div>
        
      
        
        <p>[a_time, d_time] = times</p>

        
          <div class='highlight'><pre>      param.cancelScheduledValues t
      param.setValueAtTime base , t
      ramp a, t + times[<span class="hljs-number">0</span>]
      ramp s, t + times[<span class="hljs-number">0</span>] + times[<span class="hljs-number">1</span>]
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(times.length <span class="hljs-keyword">is</span> <span class="hljs-number">3</span>)</pre></div>
        
      
        
        <p>[a_time, s_time, r_time] = times</p>

        
          <div class='highlight'><pre>      param.cancelScheduledValues t
      param.setValueAtTime base , t
      ramp a, t + times[<span class="hljs-number">0</span>]
      param.setValueAtTime a, t + times[<span class="hljs-number">0</span>] + times[<span class="hljs-number">1</span>]
      ramp base , t + times[<span class="hljs-number">0</span>] + times[<span class="hljs-number">1</span>] + times[<span class="hljs-number">2</span>]
    <span class="hljs-keyword">else</span></pre></div>
        
      
        
        <p>[a_time, d_time, s_time, r_time] = times</p>

        
          <div class='highlight'><pre>      param.cancelScheduledValues t
      param.setValueAtTime base , t
      ramp a, t + times[<span class="hljs-number">0</span>]
      ramp s, t + times[<span class="hljs-number">0</span>] + times[<span class="hljs-number">1</span>]
      param.setValueAtTime s, t + times[<span class="hljs-number">0</span>] + times[<span class="hljs-number">1</span>] + times[<span class="hljs-number">2</span>]
      ramp base , t + times[<span class="hljs-number">0</span>] + times[<span class="hljs-number">1</span>] + times[<span class="hljs-number">2</span>] + times[<span class="hljs-number">3</span>]</pre></div>
        
      
        
        <h3 id="mooogaudionode-debug">MooogAudioNode.debug</h3>
<p>Logs to the console if the debug config option is on</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">debug</span>: <span class="hljs-function"><span class="hljs-params">(a...)</span> -&gt;</span>
    <span class="hljs-built_in">console</span>.log(a...) <span class="hljs-keyword">if</span> <span class="hljs-property">@_instance</span>.config.debug</pre></div>
        
      
        
        <h2 id="analyser">Analyser</h2>
<p>Wraps the AnalyserNode AudioContext object</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Analyser</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    config.node_type = <span class="hljs-string">'Analyser'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config
    <span class="hljs-property">@insert_node</span> <span class="hljs-property">@context</span>.createAnalyser(), <span class="hljs-number">0</span>
    <span class="hljs-property">@zero_node_setup</span> config</pre></div>
        
      
        
        <h2 id="audiobuffersource">AudioBufferSource</h2>
<p><code>start()</code> and <code>stop()</code> are patched to work repeatedly on the same node by keeping
manipulating the loop start and end times and muting the output to simulate re-starting
playback from 0</p>
<p>Wraps the AudioBufferSourceNode AudioContext object</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AudioBufferSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    config.node_type = <span class="hljs-string">'AudioBufferSource'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config
    
    <span class="hljs-property">@insert_node</span> <span class="hljs-property">@context</span>.createBufferSource(), <span class="hljs-number">0</span>
    <span class="hljs-property">@define_buffer_source_properties</span>()
    
    <span class="hljs-property">@zero_node_setup</span> config
    
    <span class="hljs-property">@insert_node</span> <span class="hljs-keyword">new</span> Gain <span class="hljs-property">@_instance</span>, {
      <span class="hljs-attribute">gain</span>: <span class="hljs-number">1.0</span>
      <span class="hljs-attribute">connect_to_destination</span>: <span class="hljs-property">@config</span>.connect_to_destination
      }
    <span class="hljs-property">@_is_started</span> = <span class="hljs-literal">false</span>
    <span class="hljs-property">@_stop_timeout</span> = <span class="hljs-literal">false</span>
    <span class="hljs-property">@_state</span> = <span class="hljs-string">'stopped'</span>
    <span class="hljs-property">@define_readonly_property</span> <span class="hljs-string">'state'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>
      <span class="hljs-property">@_state</span>
    <span class="hljs-property">@_true_loop</span> = <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].<span class="hljs-keyword">loop</span>
    <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].<span class="hljs-keyword">loop</span> = <span class="hljs-literal">true</span>
    <span class="hljs-property">@_true_loopStart</span> = <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopStart
    <span class="hljs-property">@_true_loopEnd</span> = <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopEnd
    
    
    
    Object.defineProperty @, <span class="hljs-string">'loop'</span>, {
      <span class="hljs-attribute">get</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@_true_loop</span>
      <span class="hljs-attribute">set</span>: <span class="hljs-function"><span class="hljs-params">(val)</span> =&gt;</span>
        <span class="hljs-property">@_true_loop</span> = val
        <span class="hljs-keyword">if</span> <span class="hljs-property">@_state</span> <span class="hljs-keyword">is</span> <span class="hljs-string">'playing'</span>
          <span class="hljs-keyword">if</span> val
            <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopEnd = <span class="hljs-property">@_true_loopEnd</span>
            <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopStart = <span class="hljs-property">@_true_loopStart</span>
          <span class="hljs-keyword">else</span>
            <span class="hljs-property">@_true_loopEnd</span> = <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopEnd
            <span class="hljs-property">@_true_loopStart</span> = <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopStart
      <span class="hljs-attribute">enumerable</span>: <span class="hljs-literal">true</span>
      <span class="hljs-attribute">configurable</span>: <span class="hljs-literal">true</span>
    }
    
    Object.defineProperty @, <span class="hljs-string">'loopStart'</span>, {
      <span class="hljs-attribute">get</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@_true_loopStart</span>
      <span class="hljs-attribute">set</span>: <span class="hljs-function"><span class="hljs-params">(val)</span> =&gt;</span>
        <span class="hljs-property">@_true_loopStart</span> = val
        <span class="hljs-keyword">if</span> <span class="hljs-property">@_true_loop</span> <span class="hljs-keyword">and</span> <span class="hljs-property">@_state</span> <span class="hljs-keyword">is</span> <span class="hljs-string">'playing'</span>
          <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopStart = <span class="hljs-property">@_true_loopStart</span>
      <span class="hljs-attribute">enumerable</span>: <span class="hljs-literal">true</span>
      <span class="hljs-attribute">configurable</span>: <span class="hljs-literal">true</span>
    }
    
    Object.defineProperty @, <span class="hljs-string">'loopEnd'</span>, {
      <span class="hljs-attribute">get</span>: <span class="hljs-function">-&gt;</span>
        <span class="hljs-property">@_true_loopEnd</span>
      <span class="hljs-attribute">set</span>: <span class="hljs-function"><span class="hljs-params">(val)</span> =&gt;</span>
        <span class="hljs-property">@_true_loopEnd</span> = val
        <span class="hljs-keyword">if</span> <span class="hljs-property">@_true_loop</span> <span class="hljs-keyword">and</span> <span class="hljs-property">@_state</span> <span class="hljs-keyword">is</span> <span class="hljs-string">'playing'</span>
          <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopEnd = <span class="hljs-property">@_true_loopEnd</span>
      <span class="hljs-attribute">enumerable</span>: <span class="hljs-literal">true</span>
      <span class="hljs-attribute">configurable</span>: <span class="hljs-literal">true</span>
    }
    
    

  
  <span class="hljs-attribute">start</span>: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_state</span> <span class="hljs-keyword">is</span> <span class="hljs-string">'playing'</span>
    <span class="hljs-property">@_state</span> = <span class="hljs-string">'playing'</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@_true_loop</span>
      <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopEnd = <span class="hljs-property">@_true_loopEnd</span>
      <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopStart = <span class="hljs-property">@_true_loopStart</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopEnd = <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].buffer.duration
      <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopStart = <span class="hljs-number">0</span>
      <span class="hljs-property">@_stop_timeout</span> = setTimeout <span class="hljs-property">@stop</span>.bind(@),
      (Math.round(<span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].buffer.duration * <span class="hljs-number">1000</span>)) - <span class="hljs-number">19</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@_is_started</span>
      <span class="hljs-property">@_nodes</span>[<span class="hljs-number">1</span>].gain.value = <span class="hljs-number">1.0</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].start()
      <span class="hljs-property">@_is_started</span> = <span class="hljs-literal">true</span>
    @
  
  <span class="hljs-attribute">stop</span>: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_state</span> <span class="hljs-keyword">is</span> <span class="hljs-string">'stopped'</span>
    <span class="hljs-property">@_state</span> = <span class="hljs-string">'stopped'</span>
    clearTimeout <span class="hljs-property">@_stop_timeout</span>
    <span class="hljs-property">@_nodes</span>[<span class="hljs-number">1</span>].gain.value = <span class="hljs-number">0</span>
    <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopStart = <span class="hljs-number">0</span>
    <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].loopEnd = <span class="hljs-number">0.005</span>
    @</pre></div>
        
      
        
        <h2 id="biquadfilter">BiquadFilter</h2>
<p>Wraps the BiquadFilterNode AudioContext object</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BiquadFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    config.node_type = <span class="hljs-string">'BiquadFilter'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config
    <span class="hljs-property">@insert_node</span> <span class="hljs-property">@context</span>.createBiquadFilter(), <span class="hljs-number">0</span>
    <span class="hljs-property">@zero_node_setup</span> config</pre></div>
        
      
        
        <h2 id="convolver">Convolver</h2>
<p>Wraps the ConvolverNode AudioContext object</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Convolver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    config.node_type = <span class="hljs-string">'Convolver'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config
    
    <span class="hljs-property">@insert_node</span> <span class="hljs-property">@context</span>.createConvolver(), <span class="hljs-number">0</span>
    <span class="hljs-property">@define_buffer_source_properties</span>()
    
    
    <span class="hljs-property">@zero_node_setup</span> config</pre></div>
        
      
        
        <h2 id="delay">Delay</h2>
<p>Wraps the DelayNode AudioContext object. Has a built-in <code>feedback</code>
parameter (off by default).</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Delay</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    config.node_type = <span class="hljs-string">'Delay'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config
    <span class="hljs-property">@insert_node</span> <span class="hljs-property">@context</span>.createDelay(), <span class="hljs-number">0</span>
    
    <span class="hljs-property">@_feedback_stage</span> = <span class="hljs-keyword">new</span> Gain( <span class="hljs-property">@_instance</span>, { <span class="hljs-attribute">connect_to_destination</span>: <span class="hljs-literal">false</span>, <span class="hljs-attribute">gain</span>: <span class="hljs-number">0</span> } )
    <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].connect <span class="hljs-property">@to</span> <span class="hljs-property">@_feedback_stage</span>
    <span class="hljs-property">@_feedback_stage</span>.connect <span class="hljs-property">@to</span> <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>]
    <span class="hljs-property">@feedback</span> = <span class="hljs-property">@_feedback_stage</span>.gain
    
    <span class="hljs-property">@zero_node_setup</span> config</pre></div>
        
      
        
        <h2 id="dynamicscompressor">DynamicsCompressor</h2>
<p>Wraps the DynamicsCompressorNode AudioContext object</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DynamicsCompressor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    config.node_type = <span class="hljs-string">'DynamicsCompressor'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config
    <span class="hljs-property">@insert_node</span> <span class="hljs-property">@context</span>.createDynamicsCompressor(), <span class="hljs-number">0</span>
    <span class="hljs-property">@zero_node_setup</span> config</pre></div>
        
      
        
        <h2 id="gain">Gain</h2>
<p>Wraps the GainNode AudioContext object</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Gain</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    config.node_type = <span class="hljs-string">'Gain'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config
    <span class="hljs-property">@insert_node</span> <span class="hljs-property">@context</span>.createGain(), <span class="hljs-number">0</span>
    <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].gain.value = <span class="hljs-property">@_instance</span>.config.default_gain
    <span class="hljs-property">@zero_node_setup</span> config</pre></div>
        
      
        
        <h2 id="oscillator">Oscillator</h2>
<p>Wraps the OscillatorNode AudioContext object</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Oscillator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    config.node_type = <span class="hljs-string">'Oscillator'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config
    <span class="hljs-property">@insert_node</span> <span class="hljs-property">@context</span>.createOscillator(), <span class="hljs-number">0</span>
    <span class="hljs-property">@zero_node_setup</span> config
    
    
    <span class="hljs-property">@insert_node</span> <span class="hljs-keyword">new</span> Gain( <span class="hljs-property">@_instance</span>, { <span class="hljs-attribute">connect_to_destination</span>: <span class="hljs-property">@config</span>.connect_to_destination } )
    <span class="hljs-property">@_is_started</span> = <span class="hljs-literal">false</span>
    <span class="hljs-property">@_state</span> = <span class="hljs-string">'stopped'</span>
    <span class="hljs-property">@define_readonly_property</span> <span class="hljs-string">'state'</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>
      <span class="hljs-property">@_state</span>
  
  <span class="hljs-attribute">start</span>: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_state</span> <span class="hljs-keyword">is</span> <span class="hljs-string">'playing'</span>
    <span class="hljs-property">@_state</span> = <span class="hljs-string">'playing'</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@_is_started</span>
      <span class="hljs-property">@_nodes</span>[<span class="hljs-number">1</span>].gain.value = <span class="hljs-number">1.0</span>
    <span class="hljs-keyword">else</span>
      <span class="hljs-property">@_nodes</span>[<span class="hljs-number">0</span>].start()
      <span class="hljs-property">@_is_started</span> = <span class="hljs-literal">true</span>
    @
  
  <span class="hljs-attribute">stop</span>: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_state</span> <span class="hljs-keyword">is</span> <span class="hljs-string">'stopped'</span>
    <span class="hljs-property">@_state</span> = <span class="hljs-string">'stopped'</span>
    <span class="hljs-property">@_nodes</span>[<span class="hljs-number">1</span>].gain.value = <span class="hljs-number">0</span>
    @</pre></div>
        
      
        
        <h2 id="stereopanner">StereoPanner</h2>
<p>Wraps the StereoPannerNode AudioContext object</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StereoPanner</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    config.node_type = <span class="hljs-string">'StereoPanner'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config
    <span class="hljs-property">@insert_node</span> <span class="hljs-property">@context</span>.createStereoPanner(), <span class="hljs-number">0</span>
    <span class="hljs-property">@zero_node_setup</span> config</pre></div>
        
      
        
        <h2 id="track">Track</h2>
<p>A convenience function that creates a chain with the specified node(s)
followed by a panner/gain stage. It can also create pre/post sends with their 
own gain. The gain and pan <code>AudioParams</code> of those stages can be accessed
via <code>gain</code> and <code>pan</code> methods exposed on the track object.</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Track</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>


  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    <span class="hljs-property">@_sends</span> = {}
    <span class="hljs-property">@debug</span> <span class="hljs-string">'initializing track object'</span>
    config.node_type = <span class="hljs-string">'Track'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config</pre></div>
        
      
        
        <p>todo: make sure we don’t need to use insert_node() for this
todo: decide whether to make stereoPanner the default</p>

        
          <div class='highlight'><pre>    <span class="hljs-property">@_pan_stage</span> = <span class="hljs-property">@_instance</span>.context.createStereoPanner()
    <span class="hljs-property">@_gain_stage</span> = <span class="hljs-property">@_instance</span>.context.createGain()
    <span class="hljs-property">@_gain_stage</span>.gain.value = <span class="hljs-property">@_instance</span>.config.default_gain
    <span class="hljs-property">@_pan_stage</span>.connect <span class="hljs-property">@_gain_stage</span>
    <span class="hljs-property">@_gain_stage</span>.connect <span class="hljs-property">@_destination</span>
    <span class="hljs-property">@_destination</span> = <span class="hljs-property">@_pan_stage</span>
    <span class="hljs-property">@gain</span> = <span class="hljs-property">@_gain_stage</span>.gain
    <span class="hljs-property">@pan</span> = <span class="hljs-property">@_gain_stage</span>.gain
    
    <span class="hljs-property">@zero_node_setup</span> config</pre></div>
        
      
        
        <h3 id="track-send">Track.send</h3>
<p>Creates a send to another <code>Track</code> object.<br><code>id</code>: String ID to assign to this send.<br><code>destination</code>: The target <code>Track</code> object or ID thereof<br><code>pre</code>: Either ‘pre’ or ‘post’. <em>Defaults to config value in the <code>Mooog</code> object.</em><br><code>gain</code>: Initial gain value for the send. <em>Defaults to config value in the <code>Mooog</code> object.</em>  </p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">send</span>: (id,
    dest,
    pre = <span class="hljs-property">@_instance</span>.config.default_send_type,
    gain = <span class="hljs-property">@_instance</span>.config.default_gain) -&gt;
    <span class="hljs-keyword">return</span> <span class="hljs-property">@_sends</span>[id] <span class="hljs-keyword">unless</span> dest?
    source = <span class="hljs-keyword">if</span> (pre <span class="hljs-keyword">is</span> <span class="hljs-string">'pre'</span>) <span class="hljs-keyword">then</span> <span class="hljs-property">@_nodes</span>[<span class="hljs-property">@_nodes</span>.length - <span class="hljs-number">1</span>] <span class="hljs-keyword">else</span> <span class="hljs-property">@_gain_stage</span>
    gain = <span class="hljs-keyword">if</span> <span class="hljs-property">@_sends</span>[id] <span class="hljs-keyword">then</span> <span class="hljs-property">@_sends</span>[id] <span class="hljs-keyword">else</span> <span class="hljs-keyword">new</span> Gain(
      <span class="hljs-property">@_instance</span>, { <span class="hljs-attribute">connect_to_destination</span>: <span class="hljs-literal">false</span>, <span class="hljs-attribute">gain</span>: gain }
    )
    source.connect <span class="hljs-property">@to</span> gain
    gain.connect <span class="hljs-property">@to</span> dest
    gain</pre></div>
        
      
        
        <h2 id="waveshaper">WaveShaper</h2>
<p>Wraps the WaveShaperNode AudioContext object</p>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WaveShaper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MooogAudioNode</span></span>
  
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@_instance</span>, config = {})</span> -&gt;</span>
    config.node_type = <span class="hljs-string">'WaveShaper'</span>
    <span class="hljs-keyword">super</span>
    <span class="hljs-property">@configure_from</span> config
    <span class="hljs-property">@insert_node</span> <span class="hljs-property">@context</span>.createWaveShaper(), <span class="hljs-number">0</span>
    <span class="hljs-property">@zero_node_setup</span> config


  
  <span class="hljs-attribute">chebyshev</span>: <span class="hljs-function"><span class="hljs-params">(terms, last = [<span class="hljs-number">1</span>], current = [<span class="hljs-number">1</span>,<span class="hljs-number">0</span>])</span> -&gt;</span>
    <span class="hljs-keyword">if</span> terms &lt; <span class="hljs-number">2</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Terms must be 2 or more for chebyshev generator"</span>)
    <span class="hljs-keyword">if</span> current.length <span class="hljs-keyword">is</span> terms
      <span class="hljs-keyword">return</span> <span class="hljs-property">@poly</span>.apply @, current
    <span class="hljs-keyword">else</span>
      lasttemp = last
      last = current
      current = current.map( <span class="hljs-function"><span class="hljs-params">(x)</span>-&gt;</span> <span class="hljs-number">2</span>*x )
      current.push <span class="hljs-number">0</span>
      lasttemp.unshift <span class="hljs-number">0</span>, <span class="hljs-number">0</span>
      lasttemp = lasttemp.map( <span class="hljs-function"><span class="hljs-params">(x)</span> -&gt;</span> -<span class="hljs-number">1</span> * x )
      newcurrent = <span class="hljs-keyword">for</span> el, i <span class="hljs-keyword">in</span> current
        lasttemp[i] + current[i]
      <span class="hljs-built_in">console</span>.log current, lasttemp, <span class="hljs-string">"new cur"</span>, newcurrent, <span class="hljs-keyword">this</span>
      <span class="hljs-keyword">return</span> <span class="hljs-property">@chebyshev</span> terms, last, newcurrent</pre></div>
        
      
        
        <p>used by the chebyshev generator once the coefficients have been calculated</p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">poly</span>: <span class="hljs-function"><span class="hljs-params">(coeffs...)</span> -&gt;</span>
    length = <span class="hljs-property">@_instance</span>.config.curve_length
    step = <span class="hljs-number">2</span>/(length - <span class="hljs-number">1</span>)
    curve = <span class="hljs-keyword">new</span> Float32Array(length)
<span class="hljs-function">    <span class="hljs-title">p</span> = <span class="hljs-params">(x, coeffs)</span> -&gt;</span>
      accum = <span class="hljs-number">0</span>
      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.(coeffs.length-<span class="hljs-number">1</span>)]
        a = coeffs[i]
        accum += (a * Math.pow(x, coeffs.length - i - <span class="hljs-number">1</span>))
      accum

    curve[i] = ( p(((i * step) - <span class="hljs-number">1</span>), coeffs) ) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.length-<span class="hljs-number">1</span>]
    curve
  

  
  
  <span class="hljs-attribute">tanh</span>: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    length = <span class="hljs-property">@_instance</span>.config.curve_length
    step = <span class="hljs-number">2</span> / (length - <span class="hljs-number">1</span>)
    curve = <span class="hljs-keyword">new</span> Float32Array(length)
    curve[i] = (
      Math.tanh((Math.PI / <span class="hljs-number">2</span>) * n * ((i * step) - <span class="hljs-number">1</span>))
    ) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.length-<span class="hljs-number">1</span>]
    curve</pre></div>
        
      
        
        <h2 id="mooog">Mooog</h2>
<p>Wraps the AudioContext object and exposes the Track object. Exposes the API
as the Mooog global.<br>Config options:</p>
<ul>
<li>debug: Output debugging messages to the console. <em>Default: false</em></li>
<li>default_gain: <code>Gain</code> objects that are initiated will have their gain
automatically set to this value. <em>Default: 0.5</em></li>
<li>default_ramp_type: <code>adsr</code> envelopes will be produced with this type of curve 
<em>Default: ‘linear’</em></li>
</ul>

        
          <div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Mooog</span></span>

  <span class="hljs-property">@LEGAL_NODES</span>:
    <span class="hljs-string">'Oscillator'</span>: Oscillator
    <span class="hljs-string">'StereoPanner'</span>: StereoPanner
    <span class="hljs-string">'Gain'</span>: Gain
    <span class="hljs-string">'AudioBufferSource'</span>: AudioBufferSource
    <span class="hljs-string">'Convolver'</span>: Convolver
    <span class="hljs-string">'BiquadFilter'</span>: BiquadFilter
    <span class="hljs-string">'Analyser'</span>: Analyser
    <span class="hljs-string">'DynamicsCompressor'</span>: DynamicsCompressor
    <span class="hljs-string">'Delay'</span>: Delay
    <span class="hljs-string">'WaveShaper'</span>: WaveShaper

  
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(<span class="hljs-property">@initConfig</span> = {})</span> -&gt;</span></pre></div>
        
      
        
        <p><code>_BROWSER_CONSTRUCTOR</code> Stores the type of constructor used for the AudioContext 
object (<code>AudioContext</code> or <code>webkitAudioContext</code>)</p>

        
          <div class='highlight'><pre>    <span class="hljs-property">@_BROWSER_CONSTRUCTOR</span> = <span class="hljs-literal">false</span>
    <span class="hljs-property">@context</span> = <span class="hljs-property">@create_context</span>()
    <span class="hljs-property">@_destination</span> = <span class="hljs-property">@context</span>.destination
    <span class="hljs-property">@config</span> =
      <span class="hljs-attribute">debug</span>: <span class="hljs-literal">false</span>
      <span class="hljs-attribute">default_gain</span>: <span class="hljs-number">0.5</span>
      <span class="hljs-attribute">default_ramp_type</span>: <span class="hljs-string">'exponential'</span>
      <span class="hljs-attribute">default_send_type</span>: <span class="hljs-string">'post'</span>
      <span class="hljs-attribute">periodic_wave_length</span>: <span class="hljs-number">2048</span>
      <span class="hljs-attribute">curve_length</span>: <span class="hljs-number">65536</span>
      <span class="hljs-attribute">fake_zero</span>: <span class="hljs-number">1</span>/<span class="hljs-number">32768</span>
    <span class="hljs-property">@init</span>(<span class="hljs-property">@initConfig</span>)

    <span class="hljs-property">@_nodes</span> = {}</pre></div>
        
      
        
        <p>@_connections = {}</p>

        
          <div class='highlight'><pre>


  <span class="hljs-attribute">init</span>: <span class="hljs-function"><span class="hljs-params">(initConfig)</span> -&gt;</span>
    <span class="hljs-keyword">for</span> key, val <span class="hljs-keyword">of</span> <span class="hljs-property">@config</span>
      <span class="hljs-keyword">if</span> initConfig[key]?
        <span class="hljs-property">@config</span>[key] = initConfig[key]


  <span class="hljs-attribute">create_context</span>: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.AudioContext?)
      <span class="hljs-property">@_BROWSER_CONSTRUCTOR</span> = <span class="hljs-string">'AudioContext'</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AudioContext()
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.webkitAudioContext?)
      <span class="hljs-property">@_BROWSER_CONSTRUCTOR</span> = <span class="hljs-string">'webkitAudioContext'</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> webkitAudioContext()
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"This browser does not yet support the AudioContext API"</span>)</pre></div>
        
      
        
        <h3 id="mooog-track">Mooog.track</h3>
<p>Creates a Track object holds a chain of AudioNodes. By default it includes panner
and gain stages.</p>
<p><code>id</code>: A unique identifier to assign to this Track
<code>node_list</code>: One or more config objects or <code>MooogAudioNode</code> objects to add to the <code>Track</code></p>

        
          <div class='highlight'><pre>  <span class="hljs-attribute">track</span>: <span class="hljs-function"><span class="hljs-params">(id, node_list...)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Track(<span class="hljs-keyword">this</span>) <span class="hljs-keyword">unless</span> arguments.length
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> id <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
      <span class="hljs-keyword">if</span> node_list.length
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"<span class="hljs-subst">#{id}</span> is already assigned to <span class="hljs-subst">#{<span class="hljs-property">@_nodes</span>[id]}</span>"</span>) <span class="hljs-keyword">if</span> <span class="hljs-property">@_nodes</span>[id]?
        <span class="hljs-property">@_nodes</span>[id] = <span class="hljs-keyword">new</span> Track(<span class="hljs-keyword">this</span>, { <span class="hljs-attribute">id</span>:id })
        <span class="hljs-property">@_nodes</span>[id].add node_list
        <span class="hljs-keyword">return</span> <span class="hljs-property">@_nodes</span>[id]
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_nodes</span>?[id]?
        <span class="hljs-keyword">return</span> <span class="hljs-property">@_nodes</span>[id]
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"No Track found with id <span class="hljs-subst">#{id}</span>"</span>)
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Track id must be a string"</span>)
      


    
  <span class="hljs-attribute">node</span>: <span class="hljs-function"><span class="hljs-params">(id, node_list...)</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MooogAudioNode(<span class="hljs-keyword">this</span>) <span class="hljs-keyword">unless</span> arguments.length
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> id <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
      <span class="hljs-keyword">if</span> node_list.length
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"<span class="hljs-subst">#{id}</span> is already assigned to <span class="hljs-subst">#{<span class="hljs-property">@_nodes</span>[id]}</span>"</span>) <span class="hljs-keyword">if</span> <span class="hljs-property">@_nodes</span>[id]?
        <span class="hljs-property">@_nodes</span>[id] = <span class="hljs-keyword">new</span> MooogAudioNode(<span class="hljs-keyword">this</span>, id, node_list...)
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@_nodes</span>?[id]?
        <span class="hljs-keyword">return</span> <span class="hljs-property">@_nodes</span>[id]
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"No MooogAudioNode found with id <span class="hljs-subst">#{id}</span>"</span>)
    <span class="hljs-keyword">else</span>
      node = <span class="hljs-keyword">new</span> MooogAudioNode(<span class="hljs-keyword">this</span>, [id].concat(node_list...)...)
      <span class="hljs-property">@_nodes</span>[node.id] = node</pre></div>
        
      
        
        <h3 id="mooog-freq">Mooog.freq</h3>
<p>Convenience function for converting MIDI notes to equal temperament Hz</p>

        
          <div class='highlight'><pre>  <span class="hljs-property">@freq</span>: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    <span class="hljs-number">440</span> * Math.pow(<span class="hljs-number">2</span>,((n-<span class="hljs-number">69</span>)/<span class="hljs-number">12</span>))

  
  <span class="hljs-attribute">sawtoothPeriodicWave</span>: <span class="hljs-function"><span class="hljs-params">(harms)</span> -&gt;</span>
    harms ?= <span class="hljs-property">@config</span>.periodic_wave_length
    a = [<span class="hljs-number">0</span>]
    a.push(<span class="hljs-number">1</span>/i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span>.harms-<span class="hljs-number">1</span>]
    real = <span class="hljs-keyword">new</span> Float32Array(a)
    imag = <span class="hljs-keyword">new</span> Float32Array(real.length)
    <span class="hljs-keyword">return</span> <span class="hljs-property">@context</span>.createPeriodicWave(real, imag)


  <span class="hljs-attribute">squarePeriodicWave</span>: <span class="hljs-function"><span class="hljs-params">(harms)</span> -&gt;</span>
    harms ?= <span class="hljs-property">@config</span>.periodic_wave_length
    a = [<span class="hljs-number">0</span>]
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span>.harms-<span class="hljs-number">1</span>]
      <span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span> != <span class="hljs-number">0</span>
        a.push(<span class="hljs-number">2</span>/(Math.PI * i))
      <span class="hljs-keyword">else</span>
        a.push(<span class="hljs-number">0</span>)
    real = <span class="hljs-keyword">new</span> Float32Array(a)
    imag = <span class="hljs-keyword">new</span> Float32Array(real.length)
    <span class="hljs-keyword">return</span> <span class="hljs-property">@context</span>.createPeriodicWave(real, imag)


  <span class="hljs-attribute">trianglePeriodicWave</span>: <span class="hljs-function"><span class="hljs-params">(harms)</span> -&gt;</span>
    harms ?= <span class="hljs-property">@config</span>.periodic_wave_length
    a = [<span class="hljs-number">0</span>]
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span>.harms-<span class="hljs-number">1</span>]
      <span class="hljs-keyword">if</span> i%<span class="hljs-number">2</span> != <span class="hljs-number">0</span>
        a.push(<span class="hljs-number">1</span>/(Math.pow(i,<span class="hljs-number">2</span>)))
      <span class="hljs-keyword">else</span>
        a.push(<span class="hljs-number">0</span>)
    real = <span class="hljs-keyword">new</span> Float32Array(a)
    imag = <span class="hljs-keyword">new</span> Float32Array(real.length)
    <span class="hljs-keyword">return</span> <span class="hljs-property">@context</span>.createPeriodicWave(real, imag)


  <span class="hljs-attribute">sinePeriodicWave</span>: <span class="hljs-function"><span class="hljs-params">(harms)</span> -&gt;</span>
    a = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]
    real = <span class="hljs-keyword">new</span> Float32Array(a)
    imag = <span class="hljs-keyword">new</span> Float32Array(real.length)
    <span class="hljs-keyword">return</span> <span class="hljs-property">@context</span>.createPeriodicWave(real, imag)
  



<span class="hljs-built_in">window</span>.Mooog = Mooog</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
