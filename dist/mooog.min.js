(function(){var AudioBufferSource,BiquadFilter,Convolver,Gain,Mooog,MooogAudioNode,Oscillator,StereoPanner,slice=[].slice,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;MooogAudioNode=function(){function MooogAudioNode(){var _instance,i,j,len,node_list;if(_instance=arguments[0],node_list=2<=arguments.length?slice.call(arguments,1):[],this._instance=_instance,this._destination=this._instance._destination,this.context=this._instance.context,this._nodes=[],this.config_defaults={connect_to_destination:!0},this.config={},"string"===this.__typeof(node_list[0])&&"string"===this.__typeof(node_list[1])&&null!=Mooog.LEGAL_NODES[node_list[1]])return new Mooog.LEGAL_NODES[node_list[1]](this._instance,{id:node_list[0]});if(1===node_list.length){if("MooogAudioNode"!==this.constructor.name)return;if(null!=Mooog.LEGAL_NODES[node_list[0].node_type])return new Mooog.LEGAL_NODES[node_list[0].node_type](this._instance,node_list[0]);throw new Error("Omitted or undefined node type in config options.")}for(j=0,len=node_list.length;len>j;j++){if(i=node_list[j],!Mooog.LEGAL_NODES[null!=node_list[i].node_type])throw new Error("Omitted or undefined node type in config options.");this._nodes.push(new Mooog.LEGAL_NODES[node_list[i].node_type](this._instance,node_list[i]))}}return MooogAudioNode.prototype.configure_from=function(ob){var k,ref,v;this.id=null!=ob.id?ob.id:this.new_id(),ref=this.config_defaults;for(k in ref)v=ref[k],this.config[k]=k in ob?ob[k]:this.config_defaults[k];return this.config},MooogAudioNode.prototype.zero_node_settings=function(ob){var k,v,zo;zo={};for(k in ob)v=ob[k],k in this.config_defaults||"node_type"===k||"id"===k||(zo[k]=v);return zo},MooogAudioNode.prototype.zero_node_setup=function(config){var k,ref,results,v;this.expose_methods_of(this._nodes[0]),ref=this.zero_node_settings(config),results=[];for(k in ref)v=ref[k],this.debug("zero node settings, "+k+" = "+v),results.push(this.param(k,v));return results},MooogAudioNode.prototype.toString=function(){return this.constructor.name+"#"+this.id},MooogAudioNode.prototype.new_id=function(){return this.constructor.name+"_"+Math.round(1e5*Math.random())},MooogAudioNode.prototype.__typeof=function(thing){return thing instanceof AudioParam?"AudioParam":thing instanceof AudioNode?"AudioNode":thing instanceof AudioBuffer?"AudioBuffer":thing instanceof PeriodicWave?"PeriodicWave":thing instanceof AudioListener?"AudioListener":thing instanceof MooogAudioNode?"MooogAudioNode":typeof thing},MooogAudioNode.prototype.insert_node=function(node,ord){var length;if(length=this._nodes.length,null==ord&&(ord=length),ord>length)throw new Error("Invalid index given to insert_node: "+ord+" out of "+length);return this.debug("insert_node of "+this+" for",node,ord),0===ord&&(this.connect_incoming(node),this.disconnect_incoming(this._nodes[0]),length>1&&(node.connect(this.to(this._nodes[0])),this.debug("- node.connect to ",this._nodes[0]))),ord===length&&(0!==ord&&this.safely_disconnect(this._nodes[ord-1],this.from(this._destination)),0!==ord&&this.debug("- disconnect ",this._nodes[ord-1],"from",this._destination),this.config.connect_to_destination&&(node.connect(this.to(this._destination)),this.debug("- connect",node,"to",this._destination)),0!==ord&&this._nodes[ord-1].connect(this.to(node)),0!==ord&&this.debug("- connect",this._nodes[ord-1],"to",node)),ord!==length&&0!==ord&&(this.safely_disconnect(this._nodes[ord-1],this.from(this._nodes[ord])),this.debug("- disconnect",this._nodes[ord-1],"from",this._nodes[ord]),this._nodes[ord-1].connect(this.to(node)),this.debug("- connect",this._nodes[ord-1],"to",node),node.connect(this.to(this._nodes[ord])),this.debug("- connect",node,"to",this._nodes[ord])),this._nodes.splice(ord,0,node),this.debug("- spliced:",this._nodes)},MooogAudioNode.prototype.add=function(node){return this.insert_node(node)},MooogAudioNode.prototype.connect_incoming=function(){},MooogAudioNode.prototype.disconnect_incoming=function(){},MooogAudioNode.prototype.connect=function(node,output,input,return_this){var target;switch(null==output&&(output=0),null==input&&(input=0),null==return_this&&(return_this=!0),this.debug("called connect from "+this+" to "+node+", "+output),this.__typeof(node)){case"AudioParam":return this._nodes[this._nodes.length-1].connect(node,output),this;case"string":node=this._instance.node(node),target=node._nodes[0];break;case"MooogAudioNode":target=node._nodes[0];break;case"AudioNode":target=node;break;default:throw new Error("Unknown node type passed to connect")}switch(!1){case"string"!=typeof output:this._nodes[this._nodes.length-1].connect(target[output],input);break;case"number"!=typeof output:this._nodes[this._nodes.length-1].connect(target,output,input)}return return_this?this:node},MooogAudioNode.prototype.chain=function(node,output,input){if(null==output&&(output=0),null==input&&(input=0),"AudioParam"===this.__typeof(node)&&"string"!=typeof output)throw new Error("MooogAudioNode.chain() can only target AudioParams when used with the signature .chain(target_node:Node, target_param_name:string)");return this.disconnect(this._destination),this.connect(node,output,input,!1)},MooogAudioNode.prototype.to=function(node){switch(this.__typeof(node)){case"MooogAudioNode":return node._nodes[0];case"AudioNode":return node;default:throw new Error("Unknown node type passed to connect")}},MooogAudioNode.prototype.from=MooogAudioNode.prototype.to,MooogAudioNode.prototype.expose_methods_of=function(node){var key,results,val;this.debug("exposing",node),results=[];for(key in node)if(val=node[key],null==this[key])switch(this.__typeof(val)){case"function":results.push(this[key]=val.bind(node));break;case"AudioParam":results.push(this[key]=val);break;case"string":case"number":case"boolean":case"object":results.push(function(o,node,key){return Object.defineProperty(o,key,{get:function(){return node[key]},set:function(val){return node[key]=val},enumerable:!0,configurable:!0})}(this,node,key));break;default:results.push(void 0)}return results},MooogAudioNode.prototype.safely_disconnect=function(node1,node2,output,input){var e,source,target;switch(null==output&&(output=0),null==input&&(input=0),this.__typeof(node1)){case"MooogAudioNode":source=node1._nodes[node1._nodes.length-1];break;case"AudioNode":case"AudioParam":source=node1;break;case"string":source=this._instance.node(node1);break;default:throw new Error("Unknown node type passed to disconnect")}switch(this.__typeof(node2)){case"MooogAudioNode":target=node2._nodes[0];break;case"AudioNode":case"AudioParam":target=node2;break;case"string":target=this._instance.node(node2);break;default:throw new Error("Unknown node type passed to disconnect")}try{source.disconnect(target,output,input)}catch(_error){e=_error,this.debug("ignored InvalidAccessError disconnecting "+target+" from "+source)}return this},MooogAudioNode.prototype.disconnect=function(node,output,input){return null==output&&(output=0),null==input&&(input=0),this.safely_disconnect(this,node,output,input)},MooogAudioNode.prototype.param=function(key,val){var k,v;if("object"===this.__typeof(key)){for(k in key)v=key[k],this.get_set(k,v);return this}return this.get_set(key,val)},MooogAudioNode.prototype.get_set=function(key,val){if(null!=this[key])switch(this.__typeof(this[key])){case"AudioParam":return null!=val?(this[key].setValueAtTime(val,this.context.currentTime),this):this[key].value;default:return null!=val?(this[key]=val,this):this[key]}},MooogAudioNode.prototype.define_buffer_source_properties=function(){return this._buffer_source_file_url="",Object.defineProperty(this,"buffer_source_file",{get:function(){return this._buffer_source_file_url},set:function(_this){return function(filename){var request;return request=new XMLHttpRequest,request.open("GET",filename,!0),request.responseType="arraybuffer",request.onload=function(){return _this.debug("loaded "+filename),_this._buffer_source_file_url=filename,_this._instance.context.decodeAudioData(request.response,function(buffer){return _this.debug("setting buffer",buffer),_this.buffer=buffer},function(error){throw new Error("Could not decode audio data from "+request.responseURL+" - unsupported file format?")})},request.send()}}(this),enumerable:!0,configurable:!0})},MooogAudioNode.prototype.define_readonly_property=function(prop_name,func){return Object.defineProperty(this,prop_name,{get:func,set:function(){throw new Error(this+"."+prop_name+" is read-only")},enumerable:!0,configurable:!1})},MooogAudioNode.prototype.adsr=function(param,config){var _0,a,base,s,t,times;return"string"==typeof param&&(param=this[param]),_0=this._instance.config.fake_zero,base=config.base,times=config.times,a=config.a,s=config.s,null==base&&(base=_0),0===base&&(base=_0),null==a&&(a=1),0===a&&(a=_0),null==s&&(s=1),0===s&&(s=_0),t=this.context.currentTime,times[0]||(times[0]=_0),times[1]||(times[1]=_0),times[2]||(times[2]=_0),3===times.length?(param.cancelScheduledValues(t),param.setValueAtTime(base,t),param.exponentialRampToValueAtTime(a,t+times[0]),param.setValueAtTime(a,t+times[0]+times[1]),param.exponentialRampToValueAtTime(base,t+times[0]+times[1]+times[2])):(times[3]||(times[3]=_0),param.cancelScheduledValues(t),param.setValueAtTime(base,t),param.exponentialRampToValueAtTime(a,t+times[0]),param.exponentialRampToValueAtTime(s,t+times[0]+d_time),param.setValueAtTime(s,t+times[0]+d_time+times[2]),param.exponentialRampToValueAtTime(base,t+times[0]+d_time+times[2]+times[3]))},MooogAudioNode.prototype.debug=function(){var a;return a=1<=arguments.length?slice.call(arguments,0):[],this._instance.config.debug?console.log.apply(console,a):void 0},MooogAudioNode}(),AudioBufferSource=function(superClass){function AudioBufferSource(_instance,config){this._instance=_instance,null==config&&(config={}),config.node_type="AudioBufferSource",AudioBufferSource.__super__.constructor.apply(this,arguments),this.configure_from(config),this.insert_node(this.context.createBufferSource(),0),this.define_buffer_source_properties(),this.zero_node_setup(config),this.insert_node(new Gain(this._instance,{gain:1,connect_to_destination:this.config.connect_to_destination})),this._is_started=!1,this._stop_timeout=!1,this._state="stopped",this.define_readonly_property("state",function(_this){return function(){return _this._state}}(this)),this._true_loop=this._nodes[0].loop,this._nodes[0].loop=!0,this._true_loopStart=this._nodes[0].loopStart,this._true_loopEnd=this._nodes[0].loopEnd,Object.defineProperty(this,"loop",{get:function(){return this._true_loop},set:function(_this){return function(val){return _this._true_loop=val,"playing"===_this._state?val?(_this._nodes[0].loopEnd=_this._true_loopEnd,_this._nodes[0].loopStart=_this._true_loopStart):(_this._true_loopEnd=_this._nodes[0].loopEnd,_this._true_loopStart=_this._nodes[0].loopStart):void 0}}(this),enumerable:!0,configurable:!0}),Object.defineProperty(this,"loopStart",{get:function(){return this._true_loopStart},set:function(_this){return function(val){return _this._true_loopStart=val,_this._true_loop&&"playing"===_this._state?_this._nodes[0].loopStart=_this._true_loopStart:void 0}}(this),enumerable:!0,configurable:!0}),Object.defineProperty(this,"loopEnd",{get:function(){return this._true_loopEnd},set:function(_this){return function(val){return _this._true_loopEnd=val,_this._true_loop&&"playing"===_this._state?_this._nodes[0].loopEnd=_this._true_loopEnd:void 0}}(this),enumerable:!0,configurable:!0})}return extend(AudioBufferSource,superClass),AudioBufferSource.prototype.start=function(){return"playing"!==this._state?(this._state="playing",this._true_loop?(this._nodes[0].loopEnd=this._true_loopEnd,this._nodes[0].loopStart=this._true_loopStart):(this._nodes[0].loopEnd=this._nodes[0].buffer.duration,this._nodes[0].loopStart=0,this._stop_timeout=setTimeout(this.stop.bind(this),Math.round(1e3*this._nodes[0].buffer.duration)-19)),this._is_started?this._nodes[1].gain.value=1:(this._nodes[0].start(),this._is_started=!0),this):void 0},AudioBufferSource.prototype.stop=function(){return"stopped"!==this._state?(this._state="stopped",clearTimeout(this._stop_timeout),this._nodes[1].gain.value=0,this._nodes[0].loopStart=0,this._nodes[0].loopEnd=.005,this):void 0},AudioBufferSource}(MooogAudioNode),BiquadFilter=function(superClass){function BiquadFilter(_instance,config){this._instance=_instance,null==config&&(config={}),config.node_type="BiquadFilter",BiquadFilter.__super__.constructor.apply(this,arguments),this.configure_from(config),this.insert_node(this.context.createBiquadFilter(),0),this.zero_node_setup(config)}return extend(BiquadFilter,superClass),BiquadFilter}(MooogAudioNode),Convolver=function(superClass){function Convolver(_instance,config){this._instance=_instance,null==config&&(config={}),config.node_type="Convolver",Convolver.__super__.constructor.apply(this,arguments),this.configure_from(config),this.insert_node(this.context.createConvolver(),0),this.define_buffer_source_properties(),this.zero_node_setup(config)}return extend(Convolver,superClass),Convolver}(MooogAudioNode),Gain=function(superClass){function Gain(_instance,config){this._instance=_instance,null==config&&(config={}),config.node_type="Gain",Gain.__super__.constructor.apply(this,arguments),this.configure_from(config),this.insert_node(this.context.createGain(),0),this._nodes[0].gain.value=this._instance.config.default_gain,this.zero_node_setup(config)}return extend(Gain,superClass),Gain}(MooogAudioNode),Oscillator=function(superClass){function Oscillator(_instance,config){this._instance=_instance,null==config&&(config={}),config.node_type="Oscillator",Oscillator.__super__.constructor.apply(this,arguments),this.configure_from(config),this.insert_node(this.context.createOscillator(),0),this.zero_node_setup(config),this.insert_node(new Gain(this._instance,{connect_to_destination:this.config.connect_to_destination})),this._is_started=!1,this._state="stopped",this.define_readonly_property("state",function(_this){return function(){return _this._state}}(this))}return extend(Oscillator,superClass),Oscillator.prototype.start=function(){return"playing"!==this._state?(this._state="playing",this._is_started?this._nodes[1].gain.value=1:(this._nodes[0].start(),this._is_started=!0),this):void 0},Oscillator.prototype.stop=function(){return"stopped"!==this._state?(this._state="stopped",this._nodes[1].gain.value=0,this):void 0},Oscillator}(MooogAudioNode),StereoPanner=function(superClass){function StereoPanner(_instance,config){this._instance=_instance,null==config&&(config={}),config.node_type="StereoPanner",StereoPanner.__super__.constructor.apply(this,arguments),this.configure_from(config),this.insert_node(this.context.createStereoPanner(),0),this.zero_node_setup(config)}return extend(StereoPanner,superClass),StereoPanner}(MooogAudioNode),Mooog=function(){function Mooog(initConfig1){this.initConfig=null!=initConfig1?initConfig1:{},this._BROWSER_CONSTRUCTOR=!1,this.context=this.create_context(),this._destination=this.context.destination,this.config={debug:!1,default_gain:.5,periodic_wave_length:2048,fake_zero:1/32768},this.init(this.initConfig),this._nodes={}}return Mooog.LEGAL_NODES={Oscillator:Oscillator,StereoPanner:StereoPanner,Gain:Gain,AudioBufferSource:AudioBufferSource,Convolver:Convolver,BiquadFilter:BiquadFilter},Mooog.prototype.init=function(initConfig){var key,ref,results,val;ref=this.config,results=[];for(key in ref)val=ref[key],null!=initConfig[key]?results.push(this.config[key]=initConfig[key]):results.push(void 0);return results},Mooog.prototype.create_context=function(){if(null!=window.AudioContext)return this._BROWSER_CONSTRUCTOR="AudioContext",new AudioContext;if(null!=window.webkitAudioContext)return this._BROWSER_CONSTRUCTOR="webkitAudioContext",new webkitAudioContext;throw new Error("This browser does not yet support the AudioContext API")},Mooog.prototype.node=function(){var id,node,node_list,ref,ref1;if(id=arguments[0],node_list=2<=arguments.length?slice.call(arguments,1):[],!arguments.length)return new MooogAudioNode(this);if("string"==typeof id){if(node_list.length)return this._nodes[id]=function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(MooogAudioNode,[this,id].concat(slice.call(node_list)),function(){});if(null!=(null!=(ref=this._nodes)?ref[id]:void 0))return this._nodes[id];throw new Error("No MooogAudioNode found with id "+id)}return node=function(func,args,ctor){ctor.prototype=func.prototype;var child=new ctor,result=func.apply(child,args);return Object(result)===result?result:child}(MooogAudioNode,[this].concat(slice.call((ref1=[id]).concat.apply(ref1,node_list))),function(){}),this._nodes[node.id]=node},Mooog.freq=function(n){return 440*Math.pow(2,(n-69)/12)},Mooog.prototype.sawtoothPeriodicWave=function(harms){var a,i,imag,j,real,ref;for(null==harms&&(harms=this.config.periodic_wave_length),a=[0],i=j=1,ref=harms-1;ref>=1?ref>=j:j>=ref;i=ref>=1?++j:--j)a.push(1/i);return real=new Float32Array(a),imag=new Float32Array(real.length),this.context.createPeriodicWave(real,imag)},Mooog.prototype.squarePeriodicWave=function(harms){var a,i,imag,j,real,ref;for(null==harms&&(harms=this.config.periodic_wave_length),a=[0],i=j=1,ref=harms-1;ref>=1?ref>=j:j>=ref;i=ref>=1?++j:--j)i%2!==0?a.push(2/(Math.PI*i)):a.push(0);return real=new Float32Array(a),imag=new Float32Array(real.length),this.context.createPeriodicWave(real,imag)},Mooog.prototype.trianglePeriodicWave=function(harms){var a,i,imag,j,real,ref;for(null==harms&&(harms=this.config.periodic_wave_length),a=[0],i=j=1,ref=harms-1;ref>=1?ref>=j:j>=ref;i=ref>=1?++j:--j)i%2!==0?a.push(1/Math.pow(i,2)):a.push(0);return real=new Float32Array(a),imag=new Float32Array(real.length),this.context.createPeriodicWave(real,imag)},Mooog.prototype.sinePeriodicWave=function(harms){var a,imag,real;return a=[0,1],real=new Float32Array(a),imag=new Float32Array(real.length),this.context.createPeriodicWave(real,imag)},Mooog}(),window.Mooog=Mooog}).call(this);
//# sourceMappingURL=mooog.min.js.map